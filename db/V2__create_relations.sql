CREATE TABLE C##LABDATABASE.author
(
    id          NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    name        VARCHAR2(50) NOT NULL,
    nationality VARCHAR2(50) NOT NULL
);

CREATE TABLE C##LABDATABASE.book
(
    id               NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    title            VARCHAR2(50) NOT NULL,
    isbn             VARCHAR2(50) NOT NULL UNIQUE,
    publication_date DATE         NOT NULL,
    pages            INTEGER      NOT NULL,
    author_id        NUMBER       NOT NULL,
    CONSTRAINT fk_author_id FOREIGN KEY (author_id) REFERENCES C##LABDATABASE.author (id) ON DELETE CASCADE
);

CREATE TABLE C##LABDATABASE.patron
(
    id   NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    name VARCHAR2(50) NOT NULL,
    type VARCHAR2(50) NOT NULL
);

CREATE TABLE C##LABDATABASE.instance
(
    id        NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    book_isbn VARCHAR2(50) NOT NULL,
    status    VARCHAR2(50) NOT NULL,
    type      VARCHAR2(50) NOT NULL,
    CONSTRAINT fk_book_isbn FOREIGN KEY (book_isbn) REFERENCES C##LABDATABASE.book (isbn) ON DELETE CASCADE
);

CREATE TABLE C##LABDATABASE.hold
(
    id             NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    patron_id      NUMBER  NOT NULL,
    instance_id    NUMBER  NOT NULL,
    date_placed    DATE    NOT NULL,
    days_to_expire INTEGER NOT NULL,
    hold_fee       REAL    NOT NULL,
    CONSTRAINT fk_patron_id FOREIGN KEY (patron_id) REFERENCES C##LABDATABASE.patron (id) ON DELETE CASCADE,
    CONSTRAINT fk_instance_id FOREIGN KEY (instance_id) REFERENCES C##LABDATABASE.instance (id) ON DELETE CASCADE
);

CREATE TABLE C##LABDATABASE.loan
(
    id          NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    hold_id     NUMBER  NOT NULL UNIQUE,
    time        INTEGER NOT NULL,
    loan_date   DATE    NOT NULL,
    due_date    DATE    NOT NULL,
    overdue_fee REAL    NOT NULL,
    CONSTRAINT fk_hold_id FOREIGN KEY (hold_id) REFERENCES C##LABDATABASE.hold (id) ON DELETE CASCADE
);

-- GARANTE OS ACESSOS AO USU√ÅRIO
GRANT ALL ON C##LABDATABASE.author TO C##LABDATABASE;
GRANT ALL ON C##LABDATABASE.book TO C##LABDATABASE;
GRANT ALL ON C##LABDATABASE.instance TO C##LABDATABASE;
GRANT ALL ON C##LABDATABASE.patron TO C##LABDATABASE;
GRANT ALL ON C##LABDATABASE.hold TO C##LABDATABASE;
GRANT ALL ON C##LABDATABASE.loan TO C##LABDATABASE;

ALTER USER C##LABDATABASE QUOTA UNLIMITED ON USERS;

